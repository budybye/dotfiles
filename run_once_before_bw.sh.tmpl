#! /usr/bin/env bash

echo "before bitwarden cli install"

case "${OSTYPE}" in
    darwin*)
        brew install mise
        mise use -g bun node -y --verbose || curl -fsSL https://bun.sh/install | bash

        brew install bitwarden-cli || bun install -g @bitwarden/cli
        bw --version
        echo "export BW_SESSION=\"$(bw unlock --raw)\"" >> .env
        ;;
    *)
        curl -fsSL https://get.mise.sh | bash || sudo apt-get install -y cargo && cargo install mise
        mise use -g bun node -y --verbose || curl -fsSL https://bun.sh/install | bash

        bun install -g @bitwarden/cli || npm install -g bitwarden
        bw --version
        echo "export BW_SESSION=\"$(bw unlock --raw)\"" >> .env
        ;;
esac
echo "bitwarden cli install complete"
