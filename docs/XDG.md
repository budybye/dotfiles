# XDG Base Directory Specification

## 概要

XDG Base Directory Specification は、Linux デスクトップ環境において、ユーザー固有のファイル（データ、設定、キャッシュなど）を適切な場所に配置するための標準仕様です。これにより、ホームディレクトリの散乱を防ぎ、一貫したファイル管理を実現します。

## 基本概念

### 主要なベースディレクトリ

1. **ユーザー固有のデータファイル**: `$XDG_DATA_HOME`
2. **ユーザー固有の設定ファイル**: `$XDG_CONFIG_HOME`
3. **ユーザー固有の状態データ**: `$XDG_STATE_HOME`
4. **ユーザー固有の実行ファイル**: `$HOME/.local/bin`
5. **ユーザー固有のキャッシュデータ**: `$XDG_CACHE_HOME`
6. **ユーザー固有のランタイムファイル**: `$XDG_RUNTIME_DIR`

### システム全体の検索パス

1. **データファイル検索パス**: `$XDG_DATA_DIRS`
2. **設定ファイル検索パス**: `$XDG_CONFIG_DIRS`

## 環境変数の詳細

### ユーザー固有ディレクトリ

#### `$XDG_DATA_HOME`

- **用途**: ユーザー固有のデータファイル
- **デフォルト**: `$HOME/.local/share`
- **例**: アプリケーションデータ、ライブラリファイル

#### `$XDG_CONFIG_HOME`

- **用途**: ユーザー固有の設定ファイル
- **デフォルト**: `$HOME/.config`
- **例**: アプリケーション設定、ユーザー設定

#### `$XDG_STATE_HOME`

- **用途**: ユーザー固有の状態データ
- **デフォルト**: `$HOME/.local/state`
- **例**: アクション履歴、ログ、最近使用したファイル、アプリケーションの現在状態

#### `$XDG_CACHE_HOME`

- **用途**: ユーザー固有の非必須（キャッシュ）データ
- **デフォルト**: `$HOME/.cache`
- **例**: 一時ファイル、ダウンロードキャッシュ

#### `$XDG_RUNTIME_DIR`

- **用途**: ユーザー固有のランタイムファイル
- **特徴**:
  - ユーザーがログイン中のみ存在
  - アクセス権限: 0700（ユーザーのみ読み書き可能）
  - システム再起動後は削除される
- **例**: ソケット、名前付きパイプ、一時的な通信ファイル

## 重要な規則

### パス設定の規則

- すべてのパスは絶対パスでなければならない
- 相対パスが指定された場合は無効として無視される

### 優先順位

1. `$XDG_DATA_HOME` > `$XDG_DATA_DIRS` の任意のディレクトリ
2. `$XDG_CONFIG_HOME` > `$XDG_CONFIG_DIRS` の任意のディレクトリ

### ディレクトリ作成

- 書き込み時にディレクトリが存在しない場合は、権限 0700 で作成を試行
- 既存ディレクトリの権限は変更しない

### ファイルアクセス

- 読み込み時にファイルにアクセスできない場合は、そのディレクトリの処理をスキップ
- 必要なファイルが見つからない場合は、エラーメッセージを表示可能

## 実用的な使用例

### アプリケーション設定の配置

```bash
# ユーザー設定（最優先）
$XDG_CONFIG_HOME/myapp/config.conf

# システム設定（フォールバック）
/etc/xdg/myapp/config.conf
```

### データファイルの配置

```bash
# ユーザーデータ（最優先）
$XDG_DATA_HOME/myapp/data.db

# システムデータ（フォールバック）
/usr/share/myapp/data.db
```

### キャッシュファイルの配置

```bash
# キャッシュファイル
$XDG_CACHE_HOME/myapp/cache.tmp
```

## 利点

1. **ホームディレクトリの整理**: 設定ファイルの散乱を防ぐ
2. **一貫性**: アプリケーション間での統一されたファイル配置
3. **柔軟性**: 環境変数による設定変更が可能
4. **バックアップ効率**: 重要なファイルと一時ファイルの分離
5. **セキュリティ**: ランタイムファイルの適切な権限管理

## 参考リンク

- [XDG Base Directory Specification (公式)](https://specifications.freedesktop.org/basedir-spec/latest/)
- [Freedesktop.org](https://freedesktop.org/)

## 関連ドキュメント

- [ディレクトリ構成](./directory.md)
- [技術スタック](./techstack.md)
