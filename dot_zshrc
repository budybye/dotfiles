## ZDOTDIR/.zshrc はインタラクティブなシェルで読み込まれるが
## ZDOTDIR/.zprofile の最後で読み込まれてるのでzshで必ず実行される

## history
# 履歴ファイルのパスを設定
if [ -d "${HOME}/.local/state/zsh" ]; then
  HISTFILE="${HOME}/.local/state/zsh/zsh_history"
  HISTSIZE=123456
  SAVEHIST=123456
  ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE="123"
else
  HISTFILE="${HOME}/.zsh_history"
  HISTSIZE=123456
  SAVEHIST=123456
fi

setopt share_history        # 履歴を他のシェルとリアルタイム共有する
setopt inc_append_history   # 実行時に履歴をファイルにに追加していく
setopt hist_verify          # ヒストリを呼び出してから実行する間に一旦編集可能
setopt hist_expand          # 補完時にヒストリを自動的に展開
setopt hist_ignore_space    # スペースで始まるコマンドは履歴に記録しない
setopt hist_ignore_all_dups # 重複を記録しない

setopt auto_param_keys      # 環境変数を補完
setopt auto_cd              # パスを直接入力してもcdする
setopt auto_pushd           # cd - [tab]で過去のディレクトリに飛べる
setopt auto_param_slash     # 自動スラッシュ補完
setopt no_beep              # ビープ音を鳴らさない
setopt no_flow_control      # ctrl+s, ctrl+q を無効にする
setopt no_nomatch           # curlマッチしない場合にエラーにしない
setopt correct              # 入力間違えしていたら、候補を出す。yで選択
setopt mark_dirs            # match directory as append slash
setopt list_types           # autocomplete list is render file mark
setopt print_eight_bit      # enable utf-8
setopt pushd_ignore_dups    # 重複したディレクトリを無視
setopt prompt_subst         # promptに変数を埋め込む

# 色
autoload -Uz colors && colors

if [ -d "${HOME}/.cache/zsh" ]; then
  # enable completion sheldonに変更？
  # autoload -Uz compinit && compinit -d "${HOME}/.cache/zsh/zcompdump-${ZSH_VERSION}"
  zstyle ':completion:*' cache-path "${HOME}/.cache/zsh/zcompcache"
fi

## 小文字でも大文字でもマッチさせる
zstyle ':completion:*' matcher-list 'm:{:a-z:}={:A-Z:}'

## 補完方法毎にグループ化する。
zstyle ':completion:*' format '%B%F{blue}%d%f%b'
zstyle ':completion:*' group-name ''

## 補完侯補をメニューから選択する。
## select=2: 補完候補を一覧から選択する。補完候補が2つ以上なければすぐに補完する。##
zstyle ':completion:*:default' menu select=2

# 補完キャッシュを有効にする
zstyle ':completion:*' rehash 1

# cdした後に自動でlsする
chpwd() {
  ls -la
}

# homebrew
if command -v brew > /dev/null 2>&1; then
  eval "$(/opt/homebrew/bin/brew shellenv)"
fi

# direnv
if command -v direnv > /dev/null 2>&1; then
  eval "$(direnv hook zsh)"
fi

# mise
if command -v mise > /dev/null 2>&1; then
  eval "$(mise activate zsh)"
  eval "$(mise activate --shims)"
fi

# starship
if command -v starship > /dev/null 2>&1; then
  eval "$(starship init zsh)"
fi

if command -v zoxide > /dev/null 2>&1; then
  eval "$(zoxide init zsh --hook prompt)"
fi

# sheldon
if command -v sheldon > /dev/null 2>&1; then
  eval "$(sheldon source)"
fi

# aliasファイルの読み込み
if [ -f "${HOME}/.aliases" ]; then
  . "${HOME}/.aliases"
fi

# 重複したPATHを削除
if command -v awk > /dev/null 2>&1;then
  export PATH="$(printf %s "${PATH}" | awk -v RS=: -v ORS=: '!arr[$0]++')"
fi
