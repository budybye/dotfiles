{{/* 基本的な機能フラグ */}}
{{- $ephemeral := false -}}{{/* 一時的なマシン（クラウドやVM）の場合はtrue */}}
{{- $headless := false -}}{{/* スクリーンとキーボードがない場合はtrue */}}
{{- $personal := false -}}{{/* 個人用シークレットが必要な場合はtrue */}}

{{/* OSとホスト名の検出 */}}
{{- $osID := .chezmoi.os -}}
{{- if (and (eq .chezmoi.os "linux") (hasKey .chezmoi.osRelease "id")) -}}
{{-     $osID = printf "%s-%s" .chezmoi.os .chezmoi.osRelease.id -}}
{{- end -}}

{{/* 環境変数とユーザー名の設定 */}}
{{- $name := "budybye" -}}
{{- $email := "101wayout@gmail.com" -}}

{{/* detect GitHub codespaces, VSCode remote containers, Docker containers, Multipass VMs, and Vagrant boxes */}}
{{- if or (env "CODESPACES") (env "REMOTE_CONTAINERS") (env "DOCKER") (env "GITHUB_ACTIONS") (eq .chezmoi.username "root" "ubuntu" "vagrant" "vscode") -}}
{{- $ephemeral = true -}}
{{- $headless = true -}}
{{- end -}}

{{/* 環境の検出 */}}
{{- if eq (env "GITHUB_ACTIONS") "true" -}}
    {{- $name = "runner" -}}
    {{- $email = "null" -}}
    {{- $personal = false -}}
    {{- $ephemeral = true -}}
    {{- $headless = true -}}
{{- else if eq (env "CODESPACES") "true" -}}
    {{- $name = "codespaces" -}}
    {{- $email = "null" -}}
    {{- $personal = false -}}
    {{- $ephemeral = true -}}
    {{- $headless = true -}}
{{- else if eq (env "REMOTE_CONTAINERS") "true" -}}
    {{- $name = "dev" -}}
    {{- $email = "null" -}}
    {{- $personal = false -}}
    {{- $ephemeral = true -}}
    {{- $headless = true -}}
{{- else if eq (env "DOCKER") "true" -}}
    {{- $name = "docker" -}}
    {{- $email = "null" -}}
    {{- $ephemeral = true -}}
    {{- $headless = true -}}
{{- else if eq .chezmoi.username "ubuntu" -}}
    {{- $name = "budybye" -}}
    {{- $email = "101wayout@gmail.com" -}}
    {{- $ephemeral = true -}}
    {{- $headless = true -}}
    {{- $personal = true -}}
{{- else if eq .chezmoi.username "hotmilk" -}}
    {{- $email = (bitwarden "item" "gh").login.password -}}
    {{- $name = (bitwarden "item" "gh").login.username -}}
    {{- $ephemeral = true -}}
    {{- $headless = true -}}
    {{- $personal = true -}}
{{- else -}}
    {{- $name = .chezmoi.username -}}
    {{- $email = "null" -}}
{{- end -}}

# シンボリックリンクを作成する
mode = "symlink"

# sourceDir = "~/dotfiles"

# ファイルのパーミッションを変更する
# umask = 0o22

scriptTempDir = "~/tmp"

{{/* age 暗号化 */}}
{{ if ne (env "GITHUB_ACTIONS") "true" }}

encryption = "age"
[age]
    identity = "~/config/chezmoi/key.txt"
    recipients = "age1nvdw6x8addcnfwsa26ed8vz7yv8y9425utujnsy7tcj64qs2ddasl2mphg"
    passphrase = true
    symmetric = true

{{ end }}

[data]
    email = {{ $email | quote }}
    name = {{ $name | quote }}
    ephemeral = {{ $ephemeral }}
    headless = {{ $headless }}
    personal = {{ $personal }}
    osid = {{ $osID | quote }}

[git]
    autoPush = false
    autoCommit = false
    autoAdd = false

[edit]
    command = "vim"
    # command = "code"
    # commandArgs = ["--wait"]

[sctiptEnv]
    SSS = "SouthSideSound"
