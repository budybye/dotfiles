#! /usr/bin/env bash

echo "install age..."
KEY_FILE=${HOME}/key.txt
echo "KEY_FILE: ${KEY_FILE}"

{{ if eq .chezmoi.os "darwin" -}}
    command -v age >/dev/null || brew install age || echo "age install failed"
{{ else if eq .chezmoi.os "linux" -}}
    command -v age >/dev/null || sudo apt-get install -y age || echo "age install failed"
{{ else -}}
    echo {{ .chezmoi.os | quote }}
    curl -sSL https://github.com/FiloSottile/age/releases/download/v1.1.2/age-v1.1.2-darwin-amd64.tar.gz | tar xz
{{ end }}


if [ ! -f ${KEY_FILE} ]; then
    age-keygen -o ${KEY_FILE}
fi
cat ${KEY_FILE}
echo "age installed"
